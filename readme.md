# Информационная система учёта средства связи (ИСУСС)

Приложение реализует функцию контроля данных о средствах связи, предоставляя следующий функционал:

- Сохранение информации в базе данных;
- Управление движениями средств связи между подразделениями и владельцами;
- Управление категорированием средств связи;
- Разделение полномочий администраторского и пользовательского доступа;
- Резервирование данных;
- Импортирование данных из внешнего источника;
- Функционалом подсчёта сроков переработки;
- Логгирование и просмотр системного журнала приложения;
- Управление целостностью данных путём подтверждения операций администратором;

## Системные требования

### Операционная система

`Linux`, `Windows 7` и выше

### Установленное ПО

`NodeJS` версии `12.13.0` и выше.
База данных `MySQL`. Для резервного копирования исполняемые файлы `mysql`и `mysqldump` должны быть заданы в переменной среды `PATH`.

### Настройка конфиругации

Конфигурация задаётся в файле `.production.env` в формате `.env` файла следующим образом:

```env
# Хост (IP-адрес) базы данных
DB_HOST=localhost
# Порт подключения базы данных (по умолчанию у mysql 3306)
DB_PORT=3306
# Имя пользователя базы данных
DB_USERNAME=root
# Пароль пользователя базы данных
DB_PASSWORD=*******
# Имя базы данных
DB_NAME=senoph
# Используемый диалект базы данных (тестировался только mysql)
DB_DIALECT=mysql
# Приватный ключ приложения
SECRET=**************
```

### Способ запуска

**ВАЖНО**
При первом запуске приложению необходимо настроить базу данных. Во время данной операции производится синхронизация таблиц, удаляющая всё содержимое базы данных и пересоздающая её с корректной структурой. Это поведение по умолчанию не включено ввиду её деструктивности, но это обязательное условие для корректной работы приложения при первом чистом запуске.

Для этой операции необходимо один раз запустить приложение с флагом `--sync` и дождаться сообщение об успешном запуске сервера.

Дальнейший штатный запуск приложения возможен с помощью файла командного пакета `start.bat` и скрипта `start.sh` на `Windows` и `Linux` соответственно. Либо ручной запуск из корневой директории релиза командой `node ./build/index.js`.

### Логгирование

Системный журнал приложения хранится в корневой директории по пути `./logs/`. Журналы записываются в три лог-файла:

- `combined.log`: Общие логи приложения, выводящиеся в консоль с доп. информацией (payload)
- `db.log`: Логи `SQL`-запросов к базе данных
- `error.log`: Схож с `combined.log`, но хранит только ошибки.

Также логи можно просмотреть в клиентском интерфейсе с учётной записи администратора, перейдя в пункт администрирование/история(логи), либо перейдя по URL `/admin/logs`. В данном разделе также хранится история действий пользователей системы

**ВАЖНО** история действий привязывается к резервной копии, при её изменении также загружается актуальная для резервной копии история.

# Техническая сторона

## Описание приложения

Это SPA-приложение, использующее `NodeJS` в качестве бека и `ReactJS` на фронте. Связь производится посредством HTTP REST-API по адресу `/api/**/*`. Бекенд использует ORM `Sequelize` для взаимодействия с базой данных. Фронт использует собственную библиотеку визуальных компонентов, а также `React Feather` для иконок. В качестве системы управления состоянием используется `@reduxjs/toolkit`, бóльшая взаимодействия с `API` осуществляется с помощью хуков `ReactJS`.

## Используемый стек технологий

### Бекенд

- Языки: `TypeScript`, `NodeJS`, `SQL`
- Модули: `Express`, `Sequelize`

### Фронтенд

- Языки: `TypeScript`, `Stylus`
- Модули: `ReactJS`, `Webpack`, `@reduxjs/toolkit`, `ReactRouter`

## Сборка

Для контроля зависимостями используется пакетный менеджер `Yarn`. Сборка производится с помощью `bash` скрипта (желательно на `Linux`), запускаемого командой `yarn deploy` из корневой директории исходного кода. Также существует вариант сборки портативной версии билда командой `yarn deploy:zip`, собирающей `.zip` архив со всем необходимым для работы приложения.

## HTTP API

С помощью `TypeScript` реализована типизация HTTP запросов к `API`. Все варианты запросов описаны в файле `/src/route/types.d.ts`, их конкретное описание приведено ниже:

### Оповещения

`GET` `/notice` -- возвращает данные о количестве неподтверждённых действий

```ts
// Ответ
phone: {
  changes: number;
  commits: number;
}
holding: {
  commits: number;
  changes: number;
}
category: {
  commits: number;
  changes: number;
}
```

### Администрирование

`GET` `/admin/backups` -- возвращает данные о резервных копиях, доступных на сервере.

```ts
// Ответ
{
  id: string;
  tag: string;
  date: string;
  size: number;
}
```

`GET` `/admin/backup/export` -- возвращает файл, `Blob` с резервной копией.

```ts
// Запрос
{
  id: string;
}
```
